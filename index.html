<!DOCTYPE html>
<html lang="en">

<head>
    <title>The Tales Curator</title>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="editor.css">
    <link rel="stylesheet" href="./ace-builds/css/theme/monokai.css">
    <script src="./scripts/utils.js" type='text/javascript'></script>
    <script src="./scripts/customization_variables.js" type='text/javascript'></script>
    <script src="./scripts/editor.js" type='text/javascript'></script>
    <script src="./scripts/parser.js" type='text/javascript'></script>
    <script src="./scripts/page_manager.js" type='text/javascript'></script>
    <script src="./scripts/save.js" type='text/javascript'></script>
    <script src="./scripts/stylist.js" type='text/javascript'></script>
    <script src="./scripts/popup.js" type='text/javascript'></script>
    <script src="./styles/default.js" type='text/javascript'></script>

    <!-- Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.2/markdown-it.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/UmemotoCtrl/mdpjs@0.1.4/js/mdp.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css"/>
    <script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js"></script>
</head>

<script type="text/javascript">
    function PrintDiv(id) {
        var data=document.getElementById('page-container').innerHTML;
        var myWindow = window.open('', 'Tales', 'fullscreen=1');
        myWindow.document.write('<html><head><title>Tales</title>');
        myWindow.document.write('<link rel="preconnect" href="https://fonts.googleapis.com">');
        myWindow.document.write('<link rel="stylesheet" href="editor.css" type="text/css" />');
        myWindow.document.write('</head>');
        myWindow.document.write(editor.style_css());
        myWindow.document.write('<body>');
        myWindow.document.write(data);

        myWindow.document.write('</body></html>');
        myWindow.document.close(); // necessary for IE >= 10

        myWindow.onload = function(){ // necessary if the div contain images
            myWindow.focus(); // necessary for IE >= 10
            myWindow.print();
            //myWindow.close();
        };
    }

    function toggle_visibility(id){
        let element = document.getElementById(id)
        console.log(element.style.visibility)
        if (element.style.visibility == "hidden") {
            element.style.visibility = "visible"
        } else {
            element.style.visibility = "hidden"
        }
    }

</script>

<div id="quick-style">
    
</div>

<body>
    <div id="options">
        <!-- Editor buttons -->
        <div class="button-container">
            <div class="widgets">
                <button title='Align Left' onclick="editor.insert_line('[left]', '[/left]', '\n\n')"><i class="fa-solid fa-align-left"></i></button>
                <button title='Align Center' onclick="editor.insert_line('[center]', '[/center]', '\n\n')"><i class="fa-solid fa-align-center"></i></button>
                <button title='Align Right' onclick="editor.insert_line('[right]', '[/right]', '\n\n')"><i class="fa-solid fa-align-right"></i></button>
                <button title='Align Justify' onclick="editor.insert_line('[justify]', '[/justify]', '\n\n')"><i class="fa-solid fa-align-justify"></i></button>
            </div>

            <div class="widgets">
                <button title='Heading' style="position: relative;">
                    <i class="fa-solid fa-heading"></i>
                    <div class="dropdown">
                        <div title="Page Title" onclick="editor.insert('# ')"><i class="bi bi-type-h1"></i> Page Title</div>
                        <div title="Section Title" onclick="editor.insert('## ')"><i class="bi bi-type-h2"></i> Section Title</div>
                        <div title="Subsection Title" onclick="editor.insert('### ')"><i class="bi bi-type-h3"></i> Subsection Title</div>
                        <div title="Paragraph Title" onclick="editor.insert('#### ')"><i class="bi bi-type-h4"></i> Paragraph Title</div>
                        <div title="Table Title" onclick="editor.insert('##### ')"><i class="bi bi-type-h5"></i> Table Title</div>
                    </div>
                </button>
                <button title='Font' style="position: relative;">
                    <i class="fa-solid fa-font"></i>
                    <div class="dropdown" id="font-family-dropdown"></div>
                </button>
                <button title='Bold' onclick="editor.insert_line('**', '**', '  \n\n')"><i class="fa-solid fa-bold"></i></button>
                <button title='Italic' onclick="editor.insert('*', '*')"><i class="fa-solid fa-italic"></i></button>
                <button title='Underline' onclick="editor.insert('[u]', '[/u]')"><i class="fa-solid fa-underline"></i></button>
                <button title='Strikethrough' onclick="editor.insert('~', '~')"><i class="fa-solid fa-strikethrough"></i></button>
            </div>
            
            <div class="widgets">
                <button title='Unordered List' onclick="editor.insert_line('- ')"><i class="fa-solid fa-list-ul"></i></button>
                <button title='Ordered List' onclick="editor.insert_line('{0}. ')"><i class="fa-solid fa-list-ol"></i></button>
                <button title='Table of Contents' onclick="editor.insert(editor.render_toc())"><i class="bi bi-list-columns"></i></button>
            </div>

            
            <div class="widgets">
            	<button title="Table" onclick="editor.insert('##### Table Title\n| Column 1 | Column 2 |\n|----------|----------|\n| Value 1  | Value 2  |')"><i class="fa-solid fa-table"></i></button>
            	<button title="Image" style="position: relative;">
                    <i class="fa-solid fa-image"></i>
                    <div class="dropdown">
                        <div title="Image" onclick="editor.insert('[image link=\'', '\']')"><i class="fa-solid fa-image"></i> Image</div>
                        <div title="Background Image" onclick="editor.insert('[image link=\'', '\' absolute top=0 left=0]')"><i class="fa-solid fa-images"></i> Background Image</div>
                    </div>
                </button>
            	<button title="Wide Block" onclick="editor.insert('[wide]', '[/wide]')"><img class="svg-icon" src='./icons/wide.svg'/></button>
			</div>

            
            <div class="widgets">
            	<button title="Column Break" onclick="editor.insert('[newcolumn]')"><img class="svg-icon" src='./icons/column-break2.svg'/></button>
            	<button title="Page Break" onclick="editor.insert('[newpage]')"><img class="svg-icon" src='./icons/page-break.svg'/></button>
            	<button title="Horizontal Space" onclick="editor.insert('[hspace 1em]')"><i class="fa-solid fa-up-down"></i></button>
            	<button title="Vertical Space" onclick="editor.insert('\n[vspace 1em]\n')"><i class="fa-solid fa-left-right"></i></button>
			</div>

            
            <div class="widgets">
            	<button title="Color Captain" onclick="toggle_visibility('color-picker-container')"><i class="fa-solid fa-palette"></i></button>
            	<button title="Text Tailor" onclick="toggle_visibility('text-barber-container')"><i class="fa-solid fa-pen-nib"></i></button>
            	<button title="Snippets Sailor" onclick="toggle_visibility('snippets-selector-container')" style="position: relative;">
                    <i class="fa-solid fa-wand-magic-sparkles"></i>
                </button>
            	<button title="Quick Snippets" style="position: relative;">
                    <i class="fa-solid fa-bolt"></i>
                    
                    <div class="dropdown">
                        <div title="Cover" onclick="editor.insert('[cover]\n\n# [s 0.15em]Title[/s]\n## [s 0.15em]Subtitle[/s]\n___\n\n[banner]HOMEBREW[/banner]\n\n[footer hide]\n[s 0.2em]Footnote[/s]\n[/footer]\n\n[/cover]')"><i class="fa-solid fa-book"></i> Cover Page</div>
                        <div title="Part" onclick="editor.insert('[part]\n\n# PART 1\n## Subtitle\n\n[/part]')"><i class="fa-solid fa-bookmark"></i> Part Page</div>
                        <div title="Footer" onclick="editor.insert('[footer show number]', '[/footer]')"><i class="fa-solid fa-asterisk"></i> Footer</div>
                        <div title="Note" onclick="editor.insert('[note]\n\n##### Note\n', '\n\n[/note]')"><i class="bi bi-sticky-fill"></i> Note</div>
                        <div title="Description" onclick="editor.insert('[description]\n\n##### Description', '\n\n[/description]')"><i class="bi bi-card-text"></i> Description</div>
                        <div title="Quote" onclick="editor.insert('\n> ', '\n> - Author\n')"><i class="bi bi-quote"></i> Quote</div>
                        <div title="Monster Stats" onclick="editor.insert(`[monster]${MONSTER_BLOCK_TEXT}[/monster]`)"><i class="fa-solid fa-skull"></i> Monster Stats</div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <div id="editor-container">
        
    </div>
</body>

<script src="ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    let editor = new BBEditor("editor-container")
    
    Coloris({
    el: '.coloris',
    swatches: [
        '#264653',
        '#2a9d8f',
        '#e9c46a',
        '#f4a261',
        '#e76f51',
        '#d62828',
        '#023e8a',
        '#0077b6',
        '#0096c7',
        '#00b4d8',
        '#48cae4'
    ]
    });

    /** Instances **/

    Coloris.setInstance('.color-selector', { 
        closeButton: true,
        closeLabel: 'Done',
    });

    let ffd = document.getElementById('font-family-dropdown')
    for(const ff of available_fonts) {
        ffd.innerHTML += `<div title="${ff}" style="font-family:${ff}, Lato, sans-serif" onclick="editor.insert('[t font=\\'${ff}\\']', '[/t]')">${ff}</div>`
    }
</script>

</html>